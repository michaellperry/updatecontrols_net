<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">


<!-- Mirrored from updatecontrols.net/doc/advanced/how-does-it-work by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:54:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>How does it work? | Update Controls .NET</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../blogapi/wlwmanifest.html" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../blogapi/rsd" />
<link rel="prev" href="../advanced.html" />
<link rel="up" href="../advanced.html" />
<link rel="next" href="object-recycling.html" />
<link rel="shortcut icon" href="../http_/updatecontrols.net/favicon.html" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/book/book4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/updatecontrols/html-elements4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/zen/zen/tabs4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/zen/zen/messages4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/zen/zen/block-editing4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/zen/zen/wireframes4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/updatecontrols/layout4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/updatecontrols/updatecontrols4b43.css?r" />
<link type="text/css" rel="stylesheet" media="print" href="../sites/all/themes/updatecontrols/print4b43.css?r" />
<!--[if IE]>
<link type="text/css" rel="stylesheet" media="all" href="/doc/sites/all/themes/zen/zen/ie.css?r" />
<![endif]-->
  <script type="text/javascript" src="../misc/jquery4b43.js?r"></script>
<script type="text/javascript" src="../misc/drupal4b43.js?r"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, { "basePath": "/doc/", "googleanalytics": { "trackOutgoing": 1, "trackMailto": 1, "trackDownload": 1, "trackDownloadExtensions": "7z|aac|avi|csv|doc|exe|flv|gif|gz|jpe?g|js|mp(3|4|e?g)|mov|pdf|phps|png|ppt|rar|sit|tar|torrent|txt|wma|wmv|xls|xml|zip" } });
//--><!]]>
</script>
</head>
<body class="not-front not-logged-in node-type-blog one-sidebar sidebar-left page-advanced-how-does-it-work section-advanced">

  <div id="page"><div id="page-inner">

    <a name="top" id="navigation-top"></a>
          <div id="skip-to-nav"><a href="#navigation">Skip to Navigation</a></div>
    
    <div id="header"><div id="header-inner" class="clear-block">

              <div id="logo-title">

                      <div id="logo"><a href="../index.html" title="Home" rel="home"><img src="../images/logosmall.jpg" alt="Home" id="logo-image" /></a></div>
          
                                    <div id="site-name"><strong>
                <a href="../index.html" title="Home" rel="home">
                Update Controls .NET                </a>
              </strong></div>
                      
          
        </div> <!-- /#logo-title -->
      
      
    </div></div> <!-- /#header-inner, /#header -->

    <div id="main"><div id="main-inner" class="clear-block with-navbar">

      <div id="content"><div id="content-inner">

        
        
                  <div id="content-header">
            <div class="breadcrumb"><a href="../index.html">Home</a> › <a href="../blog.html">Blogs</a> › <a href="../blog/1.html">MichaelLPerry&#039;s blog</a> › </div>                          <h1 class="title">How does it work?</h1>
                                                          </div> <!-- /#content-header -->
        
        <div id="content-area">
          <div id="node-34" class="node node-type-blog"><div class="node-inner">

  
  
  
      <div class="meta">
              <div class="submitted">
          Submitted by MichaelLPerry on Thu, 03/03/2011 - 16:44        </div>
      
          </div>
  
  <div class="content">
    <p>Update Controls is not magic. It determines what each property depends upon by employing a fairly simple algorithm. From there, it just hooks into data binding using the standard means.</p>
<h3>Properties and fields</h3>
<p>In .NET, you have fields and properties. A field stores data. A property is a pair of methods: get and set. Most people confuse them for the same thing, but they are actually quite different.</p>
<p>We often see properties and fields in one-to-one correspondence. We create a field called _name, then expose that through a property called Name. This pattern is so common, that Microsoft added auto-implemented properties to the C# language. But this is not the only way that fields and properties can work together.</p>
<p>A property could calculate values based on one or more fields. The fields could be in the same object, or in a related object. More than one property could access the same field. For example, a person having two fields - _firstName and _lastName – could have three properties – FirstName, LastName, and FullName. The fields and properties need not be in one-to-one correspondence.</p>
<h3>Dependent and Independent</h3>
<p>At the core of the dependency tracking algorithm are two classes:</p>
<ul>
<li><strong>Dependent</strong> keeps track of properties </li>
<li><strong>Independent</strong> keeps track of fields </li>
</ul>
<p><a href="../sites/default/files/Howdoesitwork_D16E/image.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; margin-left: 0px; border-top: 0px; margin-right: 0px; border-right: 0px" title="image" border="0" alt="image" align="right" src="../sites/default/files/Howdoesitwork_D16E/image_thumb.png" width="244" height="70" /></a>To determine the value of a property, .NET executes its get method. This code is going to access one or more fields. These are the fields that the property depends upon.</p>
<p>The two classes set up a many-to-many relationship. A Dependent keeps track of every Independent that it accesses, and an Independent keeps track of every Dependent that accesses it.</p>
<h3>Setup and teardown</h3>
<p>When a Dependent (like the one in charge of FullName) is first created, it is in a state called <strong>OUT_OF_DATE</strong>. The first time that it is accessed, it sets up the two-way relationships with its Independents. To help with this, it uses a thread-local bulletin board called “Current Dependent”.</p>
<p><a href="../sites/default/files/Howdoesitwork_D16E/image_3.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="../sites/default/files/Howdoesitwork_D16E/image_thumb_3.png" width="640" height="157" /></a> </p>
<p>At first this bulletin board is empty <strong>(1)</strong>. Before the Dependent calls the property’s get method, it posts itself to the bulletin board. Then it enters a state called <strong>UPDATING</strong>. The bulletin board now contains the Dependent for FullName <strong>(2)</strong>.</p>
<p>Then it calls the get method. This method might immediately access some fields. Or it might call other methods, that call other methods, that eventually access fields. When it does, the application calls Independent.OnGet(). The Independent writes itself to the bulletin board. After the FullName get method completes, we have the _firstName and _lastName fields on the bulletin board <strong>(3)</strong>.</p>
<p>After the Dependent calls the get method, it looks at the bulletin board. It sees that its property (FullName) depends upon the listed fields (_firstName and _lastName). So it wires up the two-way relationship between that one Dependent and those two Independents. Now the Dependent is in a state called <strong>UP_TO_DATE</strong>. This completes the setup phase.</p>
<p>Teardown occurs when an Independent changes. When Independent.OnSet() is called, it talks to every Dependent that has accessed it. For example, _firstName is accessed by both FirstName and FullName. All of these Dependents again become <strong>OUT_OF_DATE</strong>. They sever their relationships with all of their Independents. This is also the trigger that causes PropertyChanged events to fire, which in turn leads to the setup phase happening all over again.</p>
<h3>Conclusion</h3>
<p>This ebb and flow of setting up and tearing down relationships between Dependents and Independents is the basis of the dependency tracking algorithm. As you can see, there is no magic. A property simply records all of the fields that it accesses during its get method. When any of those fields change, the property is out-of-date. This is the same kind of dependency tracking that you would have to do yourself, but this all happens in code that you don’t see. That’s what makes it feel like magic.</p>
  <div id="book-navigation-32" class="book-navigation">
    
        <div class="page-links clear-block">
              <a href="../advanced.html" class="page-previous" title="Go to previous page">‹ Advanced Topics</a>
                    <a href="../advanced.html" class="page-up" title="Go to parent page">up</a>
                    <a href="object-recycling.html" class="page-next" title="Go to next page">Object Recycling ›</a>
          </div>
    
  </div>
  </div>

  <ul class="links inline"><li class="blog_usernames_blog first"><a href="../blog/1.html" title="Read MichaelLPerry&#039;s latest blog entries.">MichaelLPerry&#039;s blog</a></li>
<li class="comment_add last"><a href="../comment/reply/34.html#comment-form" title="Share your thoughts and opinions related to this posting.">Add new comment</a></li>
</ul>
</div></div> <!-- /node-inner, /node -->
  <div id="comments">
          <h2 id="comments-title">Comments</h2>
        <a id="comment-624"></a>
<div class="comment comment-published odd first comment-by-anon"><div class="comment-inner clear-block">

      <h3 class="title">
      <a href="how-does-it-work.html#comment-624" class="active">This description is not complete...</a>          </h3>
  
  
  
  <div class="submitted">
    Submitted by Anonymous on Tue, 11/15/2011 - 00:26.  </div>

  <div class="content">
    <p>...without saying what happens when a Dependent depends on another Dependent.</p>
      </div>

      <div class="links">
      <ul class="links"><li class="comment_reply first last"><a href="../comment/reply/34/624.html">reply</a></li>
</ul>    </div>
  
</div></div> <!-- /comment-inner, /comment -->
<div class="indented"><a id="comment-625"></a>
<div class="comment comment-published even comment-by-author"><div class="comment-inner clear-block">

      <h3 class="title">
      <a href="how-does-it-work.html#comment-625" class="active">Precedent</a>          </h3>
  
  
  
  <div class="submitted">
    Submitted by MichaelLPerry on Tue, 11/15/2011 - 09:49.  </div>

  <div class="content">
    <p>Good point. Both Independent and Dependent derive from a common base class: Precedent. The relationship I describe above is actually between a Dependent and a Precedent. I just tried to simplify things by showing Independent directly.</p>
<p>So since both Independent and Dependent derive from Precedent, either one can be the source of data for a Dependent. This opens the way for indirect dependencies. To finish this story, we have to build up and tear down that relationship.</p>
<p>A Dependent-Dependent relationship is built in the same way as a Dependent-Independent relationship. While the target Dependent is updating, it accesses the source Dependent. This calls OnGet(), which does two things. First, if the source Dependent is <strong>OUT_OF_DATE</strong> it pushes itself onto the Current Dependent stack and updates itself. Second, it sets up the two-way connection with the target Dependent.</p>
<p>The tear-down is just a little different. Independent has an OnSet() method, which triggers the tear down (as described above). Dependent has no OnSet() method. Instead, it tears down relationships with <em>it's</em> dependents when <em>it</em> goes <strong>OUT_OF_DATE</strong>. This process is recursive.</p>
<p>The description in the article is incomplete, but indirect dependencies are still not magic. They are simply recursive.</p>
      </div>

      <div class="links">
      <ul class="links"><li class="comment_reply first last"><a href="../comment/reply/34/625.html">reply</a></li>
</ul>    </div>
  
</div></div> <!-- /comment-inner, /comment -->
</div><a id="comment-598"></a>
<div class="comment comment-published odd comment-by-anon"><div class="comment-inner clear-block">

      <h3 class="title">
      <a href="how-does-it-work.html#comment-598" class="active">Is it worth suppressing non-change events?</a>          </h3>
  
  
  
  <div class="submitted">
    Submitted by Anonymous on Tue, 03/15/2011 - 12:03.  </div>

  <div class="content">
    <p>David again. Is there a forum? Or is it okay to post comments to random blog entries? I could email you, but when it comes to open source, I like public discussions.</p>
<p>Currently, when somebody changes an independent property, OnSet() is called on the sentry unconditionally. What if the new value is the same as the old value? How often do you suppose it's worth checking whether the new value is actually different before calling OnSet()? Independent&lt;T&gt; could do that, of course. Depending on the situation, I figure that propagating changes could be expensive. Or, propagating a single change might not be expensive, but a complex app may be structured such that there are many false updates per second. Who knows.</p>
<p>Likewise, a dependent does not always change when one of the things it depends on changes (but I don't see a mechanism to inform Dependent that the value did not change during the _update.)</p>
<p>FIXME: the documentation of WinForms UpdateControls is not available.<br />
<a href="../../documentation/namespaceDocumentation/cs/UpdateControls.html" title="http://updatecontrols.net/documentation/namespaceDocumentation/cs/UpdateControls.do">http://updatecontrols.net/documentation/namespaceDocumentation/cs/Update...</a></p>
      </div>

      <div class="links">
      <ul class="links"><li class="comment_reply first last"><a href="../comment/reply/34/598.html">reply</a></li>
</ul>    </div>
  
</div></div> <!-- /comment-inner, /comment -->
<div class="indented"><a id="comment-599"></a>
<div class="comment comment-published even last comment-by-author"><div class="comment-inner clear-block">

      <h3 class="title">
      <a href="how-does-it-work.html#comment-599" class="active">Yes, it is worth suppressing non-change events</a>          </h3>
  
  
  
  <div class="submitted">
    Submitted by MichaelLPerry on Tue, 03/15/2011 - 12:47.  </div>

  <div class="content">
    <p>Comments are welcome here, but you can also post to <a href="http://updatecontrols.codeplex.com/discussions" title="http://updatecontrols.codeplex.com/discussions">http://updatecontrols.codeplex.com/discussions</a></p>
<p>Absolutely, it is worth suppressing non-change events. If the setter calls OnSet(), then it triggers all related dependent updates. If the value hasn't actually changed, this would result in the same dependent values being recalculated (assuming determinism, which is required for this algorithm to work anyway). This is a great optimization.</p>
<p>Unfortunately, there is no way to suppress changes to dependents. If an independent changes, but a direct dependent produces the same result, indirect dependents will still fire.</p>
<p>That documentation set was hard to maintain and not entirely useful, so I took it down a couple of years ago. I'll have to remove all links to it.</p>
      </div>

      <div class="links">
      <ul class="links"><li class="comment_reply first last"><a href="../comment/reply/34/599.html">reply</a></li>
</ul>    </div>
  
</div></div> <!-- /comment-inner, /comment -->
</div>  </div>
        </div>

        
        
      </div></div> <!-- /#content-inner, /#content -->

              <div id="navbar"><div id="navbar-inner" class="clear-block region region-navbar">

          <a name="navigation" id="navigation"></a>

          
                      <div id="primary">
              <ul class="links"><li class="menu-146 first"><a href="../../cs/index-2.html" title="">WPF</a></li>
<li class="menu-147"><a href="../../cs/silverlight.html" title="">Silverlight</a></li>
<li class="menu-148"><a href="../../cs/winforms.html" title="">Winforms</a></li>
<li class="menu-149"><a href="../../cs/download.html" title="">Download</a></li>
<li class="menu-150"><a href="../index.html" title="">Documentation</a></li>
<li class="menu-151"><a href="../../cs/videos.html" title="">Videos</a></li>
<li class="menu-152 last"><a href="../../cs/contact.html" title="">Contact Us</a></li>
</ul>            </div> <!-- /#primary -->
          
          
          
        </div></div> <!-- /#navbar-inner, /#navbar -->
      
              <div id="sidebar-left"><div id="sidebar-left-inner" class="region region-left">
          <div id="block-book-0" class="block block-book region-odd odd region-count-1 count-1"><div class="block-inner">

      <h2 class="title">Sections</h2>
  
  <div class="content">
    <div id="book-block-menu-43" class="book-block-menu">
  <ul class="menu"><li class="collapsed first last"><a href="../basics.html">The Basics</a></li>
</ul></div>
<div id="book-block-menu-11" class="book-block-menu">
  <ul class="menu"><li class="collapsed first last"><a href="../examples.html">Examples</a></li>
</ul></div>
<div id="book-block-menu-12" class="book-block-menu">
  <ul class="menu"><li class="collapsed first last"><a href="../tips.html">Tips</a></li>
</ul></div>
<div id="book-block-menu-32" class="book-block-menu">
  <ul class="menu"><li class="expanded first last active-trail"><a href="../advanced.html">Advanced Topics</a><ul class="menu"><li class="leaf first active-trail"><a href="how-does-it-work.html" class="active">How does it work?</a></li>
<li class="leaf"><a href="object-recycling.html">Object Recycling</a></li>
<li class="leaf"><a href="dependent-properties.html">Dependent properties</a></li>
<li class="leaf last"><a href="fields-and-collections.html">Fields and collections using generics</a></li>
</ul></li>
</ul></div>
<div id="book-block-menu-24" class="book-block-menu">
  <ul class="menu"><li class="collapsed first last"><a href="../node/24.html">Other Articles</a></li>
</ul></div>
  </div>

  
</div></div> <!-- /block-inner, /block -->
<div id="block-node-0" class="block block-node region-even even region-count-2 count-2"><div class="block-inner">

      <h2 class="title">Subscribe</h2>
  
  <div class="content">
    <a href="../rss.xml" class="feed-icon"><img src="../misc/feed.png" alt="Syndicate content" title="Syndicate" width="16" height="16" /></a>  </div>

  
</div></div> <!-- /block-inner, /block -->
<div id="block-comment-0" class="block block-comment region-odd odd region-count-3 count-3"><div class="block-inner">

      <h2 class="title">Recent comments</h2>
  
  <div class="content">
    <div class="item-list"><ul><li class="first"><a href="../mvvm-and-linq-to-sql.html#comment-687">No longer preferred</a><br />3 years 13 weeks ago</li>
<li><a href="../mvvm-and-linq-to-sql.html#comment-684">Is this still the preferred way?</a><br />3 years 19 weeks ago</li>
<li><a href="../tips/common_mistakes_observablecollection.html#comment-668" class="active">Wrong. When replacing the</a><br />3 years 44 weeks ago</li>
<li><a href="../node/39.html#comment-667">Very nice</a><br />3 years 46 weeks ago</li>
<li><a href="../node/39.html#comment-666">Example Application</a><br />3 years 47 weeks ago</li>
<li><a href="../basics/make-command.html#comment-665">Responsibilities</a><br />4 years 3 days ago</li>
<li><a href="../basics/make-command.html#comment-664">Menus</a><br />4 years 3 days ago</li>
<li><a href="../tips/common_mistakes_observablecollection.html#comment-659" class="active">The reason that this is a</a><br />4 years 17 weeks ago</li>
<li><a href="../tips/common_mistakes_observablecollection.html#comment-658" class="active">You need to explain why these</a><br />4 years 17 weeks ago</li>
<li class="last"><a href="../validation.html#comment-657">RE: I like your approach, but ...</a><br />4 years 21 weeks ago</li>
</ul></div>  </div>

  
</div></div> <!-- /block-inner, /block -->
<div id="block-user-0" class="block block-user region-even even region-count-4 count-4"><div class="block-inner">

      <h2 class="title">User login</h2>
  
  <div class="content">
    <form action="http://updatecontrols.net/doc/advanced/how-does-it-work?destination=node%2F34"  accept-charset="UTF-8" method="post" id="user-login-form">
<div><div class="form-item" id="edit-name-wrapper">
 <label for="edit-name">Username: <span class="form-required" title="This field is required.">*</span></label>
 <input type="text" maxlength="60" name="name" id="edit-name" size="15" value="" class="form-text required" />
</div>
<div class="form-item" id="edit-pass-wrapper">
 <label for="edit-pass">Password: <span class="form-required" title="This field is required.">*</span></label>
 <input type="password" name="pass" id="edit-pass"  maxlength="60"  size="15"  class="form-text required" />
</div>
<input type="submit" name="op" id="edit-submit" value="Log in"  class="form-submit" />
<div class="item-list"><ul><li class="first last"><a href="../user/password.html" title="Request new password via e-mail.">Request new password</a></li>
</ul></div><input type="hidden" name="form_build_id" id="form-5419f0ce979aa24d63f520c9f851a182" value="form-5419f0ce979aa24d63f520c9f851a182"  />
<input type="hidden" name="form_id" id="edit-user-login-block" value="user_login_block"  />

</div></form>
  </div>

  
</div></div> <!-- /block-inner, /block -->
        </div></div> <!-- /#sidebar-left-inner, /#sidebar-left -->
      
      
    </div></div> <!-- /#main-inner, /#main -->

          <div id="footer"><div id="footer-inner" class="region region-footer">

        
        <div id="block-system-0" class="block block-system region-odd odd region-count-1 count-5"><div class="block-inner">

  
  <div class="content">
    <a href="http://drupal.org/"><img src="../misc/powered-blue-80x15.png" alt="Powered by Drupal, an open source content management system" title="Powered by Drupal, an open source content management system" width="80" height="15" /></a>  </div>

  
</div></div> <!-- /block-inner, /block -->

      </div></div> <!-- /#footer-inner, /#footer -->
    
  </div></div> <!-- /#page-inner, /#page -->

  
  <script type="text/javascript" src="../sites/all/modules/google_analytics/googleanalytics4b43.js?r"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
try{var pageTracker = _gat._getTracker("UA-389401-4");pageTracker._trackPageview();} catch(err) {}
//--><!]]>
</script>

</body>

<!-- Mirrored from updatecontrols.net/doc/advanced/how-does-it-work by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:54:53 GMT -->
</html>
