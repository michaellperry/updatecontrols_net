<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">


<!-- Mirrored from updatecontrols.net/doc/tips/data_bind_visual_states by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:54:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Data bind visual states | Update Controls .NET</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../blogapi/wlwmanifest.html" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../blogapi/rsd" />
<link rel="prev" href="view_models_in_f_sharp.html" />
<link rel="up" href="../tips.html" />
<link rel="next" href="common_mistakes_observablecollection.html" />
<link rel="shortcut icon" href="../http_/updatecontrols.net/favicon.html" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/book/book4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/updatecontrols/html-elements4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/zen/zen/tabs4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/zen/zen/messages4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/zen/zen/block-editing4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/zen/zen/wireframes4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/updatecontrols/layout4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/updatecontrols/updatecontrols4b43.css?r" />
<link type="text/css" rel="stylesheet" media="print" href="../sites/all/themes/updatecontrols/print4b43.css?r" />
<!--[if IE]>
<link type="text/css" rel="stylesheet" media="all" href="/doc/sites/all/themes/zen/zen/ie.css?r" />
<![endif]-->
  <script type="text/javascript" src="../misc/jquery4b43.js?r"></script>
<script type="text/javascript" src="../misc/drupal4b43.js?r"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, { "basePath": "/doc/", "googleanalytics": { "trackOutgoing": 1, "trackMailto": 1, "trackDownload": 1, "trackDownloadExtensions": "7z|aac|avi|csv|doc|exe|flv|gif|gz|jpe?g|js|mp(3|4|e?g)|mov|pdf|phps|png|ppt|rar|sit|tar|torrent|txt|wma|wmv|xls|xml|zip" } });
//--><!]]>
</script>
</head>
<body class="not-front not-logged-in node-type-blog one-sidebar sidebar-left page-tips-data-bind-visual-states section-tips">

  <div id="page"><div id="page-inner">

    <a name="top" id="navigation-top"></a>
          <div id="skip-to-nav"><a href="#navigation">Skip to Navigation</a></div>
    
    <div id="header"><div id="header-inner" class="clear-block">

              <div id="logo-title">

                      <div id="logo"><a href="../index.html" title="Home" rel="home"><img src="../images/logosmall.jpg" alt="Home" id="logo-image" /></a></div>
          
                                    <div id="site-name"><strong>
                <a href="../index.html" title="Home" rel="home">
                Update Controls .NET                </a>
              </strong></div>
                      
          
        </div> <!-- /#logo-title -->
      
      
    </div></div> <!-- /#header-inner, /#header -->

    <div id="main"><div id="main-inner" class="clear-block with-navbar">

      <div id="content"><div id="content-inner">

        
        
                  <div id="content-header">
            <div class="breadcrumb"><a href="../index.html">Home</a> › <a href="../blog.html">Blogs</a> › <a href="../blog/1.html">MichaelLPerry&#039;s blog</a> › </div>                          <h1 class="title">Data bind visual states</h1>
                                                          </div> <!-- /#content-header -->
        
        <div id="content-area">
          <div id="node-30" class="node node-type-blog"><div class="node-inner">

  
  
  
      <div class="meta">
              <div class="submitted">
          Submitted by MichaelLPerry on Wed, 01/19/2011 - 16:04        </div>
      
          </div>
  
  <div class="content">
    <p>The Visual State Manager in WPF and Silverlight is imperative. It has a method called “GoToState”. You invoke this method when you want the visual state to change. Data binding, on the other hand, is declarative. We don’t say <em>when</em> to do something, we just say <em>what</em> it should be. I’d like visual states to be more declarative.</p>
<p><a href="http://twitter.com/sholder">Shane Holder</a> asked if I had a solution to this problem. He used a “GoToStateAction” in Blend to control the visual state of a window. He wanted the visual state to be the current value of a property in his view model. His property type was an enumeration that matched the names of the visual states.</p>
<p><a href="../sites/default/files/Databindvisualstates_D3BF/image.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; margin-left: 0px; border-left-width: 0px; margin-right: 0px" title="image" border="0" alt="image" align="right" src="../sites/default/files/Databindvisualstates_D3BF/image_thumb.png" width="244" height="190" /></a> He set the trigger to a PropertyChangedTrigger and bound it to the enumeration property. He then bound the StateName to the same property. This worked correctly when the property changed, but did not set the visual state on load.</p>
<p>The problem is in the name: “GoToState<strong>Action”</strong>. This behavior is an action that is invoked on a specific event. It is imperative. You can get this working with more imperative code (eg. code behind, or a second GoToStateAction that triggers on the Window Loaded event). Or you can write a declarative behavior.</p>
<h3>BindVisualStateBehavior</h3>
<p>Add the following class to your WPF or Silverlight 4 project:</p>
<pre class="code"><span style="color: blue">using </span>System.Windows;
<span style="color: blue">using </span>System.Windows.Interactivity;
<span style="color: blue">using </span>Microsoft.Expression.Interactivity;

<span style="color: blue">namespace </span>BindingVisualStatesSL4
{
    <span style="color: blue">public class </span><span style="color: #2b91af">BindVisualStateBehavior </span>: <span style="color: #2b91af">Behavior</span>&lt;<span style="color: #2b91af">FrameworkElement</span>&gt;
    {
        <span style="color: blue">public static </span><span style="color: #2b91af">DependencyProperty </span>StateNameProperty = <span style="color: #2b91af">DependencyProperty</span>.Register(
            <span style="color: #a31515">&quot;StateName&quot;</span>,
            <span style="color: blue">typeof</span>(<span style="color: blue">string</span>),
            <span style="color: blue">typeof</span>(<span style="color: #2b91af">BindVisualStateBehavior</span>),
            <span style="color: blue">new </span><span style="color: #2b91af">PropertyMetadata</span>(VisualStatePropertyChanged));
        <span style="color: blue">private bool </span>_initialized = <span style="color: blue">false</span>;

        <span style="color: blue">public string </span>StateName
        {
            <span style="color: blue">get </span>{ <span style="color: blue">return </span>(<span style="color: blue">string</span>)GetValue(StateNameProperty); }
            <span style="color: blue">set </span>{ SetValue(StateNameProperty, <span style="color: blue">value</span>); }
        }

        <span style="color: blue">public void </span>UpdateVisualState(<span style="color: blue">string </span>visualState)
        {
            <span style="color: blue">if </span>(AssociatedObject != <span style="color: blue">null</span>)
            {
                <span style="color: #2b91af">FrameworkElement </span>stateTarget;
                <span style="color: blue">if </span>(<span style="color: #2b91af">VisualStateUtilities</span>.TryFindNearestStatefulControl(AssociatedObject, <span style="color: blue">out </span>stateTarget))
                {
                    <span style="color: blue">bool </span>useTransitions = _initialized;
                    <span style="color: #2b91af">VisualStateUtilities</span>.GoToState(stateTarget, visualState, useTransitions);
                    _initialized = <span style="color: blue">true</span>;
                }
            }
        }

        <span style="color: blue">private static void </span>VisualStatePropertyChanged(<span style="color: #2b91af">DependencyObject </span>obj, <span style="color: #2b91af">DependencyPropertyChangedEventArgs </span>args)
        {
            ((<span style="color: #2b91af">BindVisualStateBehavior</span>)obj).UpdateVisualState((<span style="color: blue">string</span>)args.NewValue);
        }
    }
}</pre><p>Note: this does not work in Silverlight 3 (and hence Windows Phone 7). Behavior properties were not bindable until 4.</p>
<p>This class uses the following assemblies, so add references if necessary:</p>
<ul>
<li>Microsoft.Expression.Interactions </li>
<li>System.Windows.Interactivity </li>
</ul>
<p>That first assembly comes from Blend, so you might not have it if you don’t have Blend installed. But then again, if you are not using Blend, binding visual states declaratively is the least of your problems. Defining those visual states manually in XAML is going to be a chore.</p>
<p><a href="../sites/default/files/Databindvisualstates_D3BF/image_3.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; margin-left: 0px; border-left-width: 0px; margin-right: 0px" title="image" border="0" alt="image" align="right" src="../sites/default/files/Databindvisualstates_D3BF/image_thumb_3.png" width="244" height="148" /></a> Once you add this class (and compile), then it will appear in the Blend assets pane. Drag this behavior onto a component on your art board. Then bind the StateName property. You can use either a string or an enumeration. The names of the enumeration values must match the names of your visual states.</p>
<h3>Compass example</h3>
<p>Download the <a href="../sites/default/files/Databindvisualstates_D3BF/BindingVisualStates.zip">attached source code</a> for an example of this behavior in both WPF and Silverlight 4. The example shows a compass. Select a direction radio button to move the compass needle.</p>
<div id="silverlightControlHost" style="width:300px; height: 172px;">
<object data="data:application/x-silverlight-2," type="application/x-silverlight-2" width="100%" height="100%">
    <param name="source" value="/doc/sites/default/files/Databindvisualstates_D3BF/BindingVisualStatesSL4.xap" />
    <param name="onError" value="onSilverlightError" />
    <param name="background" value="white" />
    <param name="minRuntimeVersion" value="4.0.50401.0" />
    <param name="autoUpgrade" value="true" /><a href="http://go.microsoft.com/fwlink/?LinkID=149156&amp;v=4.0.50401.0" style="text-decoration: none"><img src="http://go.microsoft.com/fwlink/?LinkId=161376" alt="Get Microsoft Silverlight" style="border-style: none" /></a><a href="http://go.microsoft.com/fwlink/?LinkID=149156&amp;v=3.0.40624.0" style="text-decoration: none"></a><iframe id="_sl_historyFrame" style="border: 0px none ; visibility: hidden; height: 0px; width: 0px"></iframe></object></div>
<p>Both the radio buttons and the visual state are bound to a simple data model. I’m not even using MVVM.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">Compass </span>: <span style="color: #2b91af">INotifyPropertyChanged
</span>{
    <span style="color: blue">private </span><span style="color: #2b91af">CompassDirection </span>_direction = <span style="color: #2b91af">CompassDirection</span>.East;

    <span style="color: blue">public </span><span style="color: #2b91af">CompassDirection </span>Direction
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_direction; }
        <span style="color: blue">set
        </span>{
            <span style="color: blue">if </span>(_direction != <span style="color: blue">value</span>)
            {
                _direction = <span style="color: blue">value</span>;
                FirePropertyChanged(<span style="color: #a31515">&quot;Direction&quot;</span>);
            }
        }
    }

    <span style="color: blue">public event </span><span style="color: #2b91af">PropertyChangedEventHandler </span>PropertyChanged;

    <span style="color: blue">private void </span>FirePropertyChanged(<span style="color: blue">string </span>propertyName)
    {
        <span style="color: blue">if </span>(PropertyChanged != <span style="color: blue">null</span>)
            PropertyChanged(<span style="color: blue">this</span>, <span style="color: blue">new </span><span style="color: #2b91af">PropertyChangedEventArgs</span>(propertyName));
    }
}</pre><p>I use a value converter to bind the enumeration to the IsChecked property of the radio buttons. I found this technique on <a href="http://stackoverflow.com/questions/397556/wpf-how-to-bind-radiobuttons-to-an-enum">Stack Overflow</a>.</p>
<h3>Update Controls</h3>
<p>You might have noticed in the code above that I did not use Update Controls. Instead, I implemented the dreaded INotifyPropertyChanged. While the BindVisualStateBehavior will work with Update Controls, I wanted to demonstrate that it did not depend upon it.</p>
<p>Update Controls is all about replacing imperative code with declarative code. Just like GoToState, PropertyChanged is imperative. You have to fire the event at just the right time. So in spirit, this behavior is related to Update Controls.</p>
<p>In practice, however, the behavior is useful even if you don’t use Update Controls. I was originally planning on making it part of the library, but instead I decided to simply post the source code. Please post a comment if you believe I should include it.</p>
<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:8eb9d37f-1541-4f29-b6f4-1eea890d4876:a9d089f5-f30c-463e-bde5-375f224c3e29" class="wlWriterEditableSmartContent">
<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:8eb9d37f-1541-4f29-b6f4-1eea890d4876:a9d089f5-f30c-463e-bde5-375f224c3e29" class="wlWriterSmartContent"></div>
</div>  <div id="book-navigation-12" class="book-navigation">
    
        <div class="page-links clear-block">
              <a href="view_models_in_f_sharp.html" class="page-previous" title="Go to previous page">‹ View Models in F#</a>
                    <a href="../tips.html" class="page-up" title="Go to parent page">up</a>
                    <a href="common_mistakes_observablecollection.html" class="page-next" title="Go to next page">Common mistakes while using ObservableCollection ›</a>
          </div>
    
  </div>
  </div>

  <ul class="links inline"><li class="blog_usernames_blog first"><a href="../blog/1.html" title="Read MichaelLPerry&#039;s latest blog entries.">MichaelLPerry&#039;s blog</a></li>
<li class="comment_add last"><a href="../comment/reply/30.html#comment-form" title="Share your thoughts and opinions related to this posting.">Add new comment</a></li>
</ul>
</div></div> <!-- /node-inner, /node -->
        </div>

        
        
      </div></div> <!-- /#content-inner, /#content -->

              <div id="navbar"><div id="navbar-inner" class="clear-block region region-navbar">

          <a name="navigation" id="navigation"></a>

          
                      <div id="primary">
              <ul class="links"><li class="menu-146 first"><a href="../../cs/index-2.html" title="">WPF</a></li>
<li class="menu-147"><a href="../../cs/silverlight.html" title="">Silverlight</a></li>
<li class="menu-148"><a href="../../cs/winforms.html" title="">Winforms</a></li>
<li class="menu-149"><a href="../../cs/download.html" title="">Download</a></li>
<li class="menu-150"><a href="../index.html" title="">Documentation</a></li>
<li class="menu-151"><a href="../../cs/videos.html" title="">Videos</a></li>
<li class="menu-152 last"><a href="../../cs/contact.html" title="">Contact Us</a></li>
</ul>            </div> <!-- /#primary -->
          
          
          
        </div></div> <!-- /#navbar-inner, /#navbar -->
      
              <div id="sidebar-left"><div id="sidebar-left-inner" class="region region-left">
          <div id="block-book-0" class="block block-book region-odd odd region-count-1 count-1"><div class="block-inner">

      <h2 class="title">Sections</h2>
  
  <div class="content">
    <div id="book-block-menu-43" class="book-block-menu">
  <ul class="menu"><li class="collapsed first last"><a href="../basics.html">The Basics</a></li>
</ul></div>
<div id="book-block-menu-11" class="book-block-menu">
  <ul class="menu"><li class="collapsed first last"><a href="../examples.html">Examples</a></li>
</ul></div>
<div id="book-block-menu-12" class="book-block-menu">
  <ul class="menu"><li class="expanded first last active-trail"><a href="../tips.html">Tips</a><ul class="menu"><li class="leaf first"><a href="do-not-use-observablecollectiont.html">Do not use ObservableCollection&lt;T&gt;</a></li>
<li class="leaf"><a href="selectionmodel.html">Selection Model</a></li>
<li class="leaf"><a href="viewmodel_navigationmodel.html">View Model and Navigation Model</a></li>
<li class="leaf"><a href="viewmodelbase.html">ViewModelBase</a></li>
<li class="leaf"><a href="../node/23.html">Custom change listeners</a></li>
<li class="leaf"><a href="list_detail.html">List and detail</a></li>
<li class="leaf"><a href="mvvm_design_time_data.html">MVVM Design Time Data</a></li>
<li class="leaf"><a href="view_models_in_f_sharp.html">View Models in F#</a></li>
<li class="leaf active-trail"><a href="data_bind_visual_states.html" class="active">Data bind visual states</a></li>
<li class="leaf last"><a href="common_mistakes_observablecollection.html">Common mistakes while using ObservableCollection</a></li>
</ul></li>
</ul></div>
<div id="book-block-menu-32" class="book-block-menu">
  <ul class="menu"><li class="collapsed first last"><a href="../advanced.html">Advanced Topics</a></li>
</ul></div>
<div id="book-block-menu-24" class="book-block-menu">
  <ul class="menu"><li class="collapsed first last"><a href="../node/24.html">Other Articles</a></li>
</ul></div>
  </div>

  
</div></div> <!-- /block-inner, /block -->
<div id="block-node-0" class="block block-node region-even even region-count-2 count-2"><div class="block-inner">

      <h2 class="title">Subscribe</h2>
  
  <div class="content">
    <a href="../rss.xml" class="feed-icon"><img src="../misc/feed.png" alt="Syndicate content" title="Syndicate" width="16" height="16" /></a>  </div>

  
</div></div> <!-- /block-inner, /block -->
<div id="block-comment-0" class="block block-comment region-odd odd region-count-3 count-3"><div class="block-inner">

      <h2 class="title">Recent comments</h2>
  
  <div class="content">
    <div class="item-list"><ul><li class="first"><a href="../mvvm-and-linq-to-sql.html#comment-687">No longer preferred</a><br />3 years 13 weeks ago</li>
<li><a href="../mvvm-and-linq-to-sql.html#comment-684">Is this still the preferred way?</a><br />3 years 19 weeks ago</li>
<li><a href="common_mistakes_observablecollection.html#comment-668" class="active">Wrong. When replacing the</a><br />3 years 44 weeks ago</li>
<li><a href="../node/39.html#comment-667">Very nice</a><br />3 years 46 weeks ago</li>
<li><a href="../node/39.html#comment-666">Example Application</a><br />3 years 47 weeks ago</li>
<li><a href="../basics/make-command.html#comment-665">Responsibilities</a><br />4 years 3 days ago</li>
<li><a href="../basics/make-command.html#comment-664">Menus</a><br />4 years 3 days ago</li>
<li><a href="common_mistakes_observablecollection.html#comment-659" class="active">The reason that this is a</a><br />4 years 17 weeks ago</li>
<li><a href="common_mistakes_observablecollection.html#comment-658" class="active">You need to explain why these</a><br />4 years 17 weeks ago</li>
<li class="last"><a href="../validation.html#comment-657">RE: I like your approach, but ...</a><br />4 years 21 weeks ago</li>
</ul></div>  </div>

  
</div></div> <!-- /block-inner, /block -->
<div id="block-user-0" class="block block-user region-even even region-count-4 count-4"><div class="block-inner">

      <h2 class="title">User login</h2>
  
  <div class="content">
    <form action="http://updatecontrols.net/doc/tips/data_bind_visual_states?destination=node%2F30"  accept-charset="UTF-8" method="post" id="user-login-form">
<div><div class="form-item" id="edit-name-wrapper">
 <label for="edit-name">Username: <span class="form-required" title="This field is required.">*</span></label>
 <input type="text" maxlength="60" name="name" id="edit-name" size="15" value="" class="form-text required" />
</div>
<div class="form-item" id="edit-pass-wrapper">
 <label for="edit-pass">Password: <span class="form-required" title="This field is required.">*</span></label>
 <input type="password" name="pass" id="edit-pass"  maxlength="60"  size="15"  class="form-text required" />
</div>
<input type="submit" name="op" id="edit-submit" value="Log in"  class="form-submit" />
<div class="item-list"><ul><li class="first last"><a href="../user/password.html" title="Request new password via e-mail.">Request new password</a></li>
</ul></div><input type="hidden" name="form_build_id" id="form-7a72800da3baef575020daf42eb507ca" value="form-7a72800da3baef575020daf42eb507ca"  />
<input type="hidden" name="form_id" id="edit-user-login-block" value="user_login_block"  />

</div></form>
  </div>

  
</div></div> <!-- /block-inner, /block -->
        </div></div> <!-- /#sidebar-left-inner, /#sidebar-left -->
      
      
    </div></div> <!-- /#main-inner, /#main -->

          <div id="footer"><div id="footer-inner" class="region region-footer">

        
        <div id="block-system-0" class="block block-system region-odd odd region-count-1 count-5"><div class="block-inner">

  
  <div class="content">
    <a href="http://drupal.org/"><img src="../misc/powered-blue-80x15.png" alt="Powered by Drupal, an open source content management system" title="Powered by Drupal, an open source content management system" width="80" height="15" /></a>  </div>

  
</div></div> <!-- /block-inner, /block -->

      </div></div> <!-- /#footer-inner, /#footer -->
    
  </div></div> <!-- /#page-inner, /#page -->

  
  <script type="text/javascript" src="../sites/all/modules/google_analytics/googleanalytics4b43.js?r"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
try{var pageTracker = _gat._getTracker("UA-389401-4");pageTracker._trackPageview();} catch(err) {}
//--><!]]>
</script>

</body>

<!-- Mirrored from updatecontrols.net/doc/tips/data_bind_visual_states by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:54:49 GMT -->
</html>
