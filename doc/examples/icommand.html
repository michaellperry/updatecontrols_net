<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">


<!-- Mirrored from updatecontrols.net/doc/examples/icommand by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:54:25 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>ICommand | Update Controls .NET</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../blogapi/wlwmanifest.html" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../blogapi/rsd" />
<link rel="prev" href="hierarchical_check_boxes.html" />
<link rel="up" href="../examples.html" />
<link rel="next" href="linq.html" />
<link rel="shortcut icon" href="../http_/updatecontrols.net/favicon.html" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/book/book4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/updatecontrols/html-elements4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/zen/zen/tabs4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/zen/zen/messages4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/zen/zen/block-editing4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/zen/zen/wireframes4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/updatecontrols/layout4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/updatecontrols/updatecontrols4b43.css?r" />
<link type="text/css" rel="stylesheet" media="print" href="../sites/all/themes/updatecontrols/print4b43.css?r" />
<!--[if IE]>
<link type="text/css" rel="stylesheet" media="all" href="/doc/sites/all/themes/zen/zen/ie.css?r" />
<![endif]-->
  <script type="text/javascript" src="../misc/jquery4b43.js?r"></script>
<script type="text/javascript" src="../misc/drupal4b43.js?r"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, { "basePath": "/doc/", "googleanalytics": { "trackOutgoing": 1, "trackMailto": 1, "trackDownload": 1, "trackDownloadExtensions": "7z|aac|avi|csv|doc|exe|flv|gif|gz|jpe?g|js|mp(3|4|e?g)|mov|pdf|phps|png|ppt|rar|sit|tar|torrent|txt|wma|wmv|xls|xml|zip" } });
//--><!]]>
</script>
</head>
<body class="not-front not-logged-in node-type-blog one-sidebar sidebar-left page-examples-icommand section-examples">

  <div id="page"><div id="page-inner">

    <a name="top" id="navigation-top"></a>
          <div id="skip-to-nav"><a href="#navigation">Skip to Navigation</a></div>
    
    <div id="header"><div id="header-inner" class="clear-block">

              <div id="logo-title">

                      <div id="logo"><a href="../index.html" title="Home" rel="home"><img src="../images/logosmall.jpg" alt="Home" id="logo-image" /></a></div>
          
                                    <div id="site-name"><strong>
                <a href="../index.html" title="Home" rel="home">
                Update Controls .NET                </a>
              </strong></div>
                      
          
        </div> <!-- /#logo-title -->
      
      
    </div></div> <!-- /#header-inner, /#header -->

    <div id="main"><div id="main-inner" class="clear-block with-navbar">

      <div id="content"><div id="content-inner">

        
        
                  <div id="content-header">
            <div class="breadcrumb"><a href="../index.html">Home</a> › <a href="../blog.html">Blogs</a> › <a href="../blog/1.html">MichaelLPerry&#039;s blog</a> › </div>                          <h1 class="title">ICommand</h1>
                                                          </div> <!-- /#content-header -->
        
        <div id="content-area">
          <div id="node-14" class="node node-type-blog"><div class="node-inner">

  
  
  
      <div class="meta">
              <div class="submitted">
          Submitted by MichaelLPerry on Sat, 10/10/2009 - 22:25        </div>
      
          </div>
  
  <div class="content">
    <p>Watch a <a href="http://updatecontrols.net/videos/CommandBinding/CommandBinding.html">video</a> on this topic, <a href="../../bin/UpdateControls.2.0.3.1.msi">download</a> the latest bits, and check out the <a href="http://updatecontrols.codeplex.com/SourceControl/changeset/view/22311#316518">source code</a>.</p>
<p>WPF gives us an interface for separating commands from the visual elements that invoke them. The ICommand interface determines whether a command can be executed, and what happens when it is. To enable or disable a visual element bound to the command, the ICommand interface also exposes an event called CanExecuteChanged. Update Controls keeps track of changes and fires this event for you.</p>
<p><strong>Why use command binding?</strong><br />When I showed you the <a href="http://adventuresinsoftware.com/blog/?p=284">Presentation Model</a> pattern, I used XAML events in code behind to handle button clicks. The problem with this approach is that it puts code in the view. This code doesn't operate on the view. In fact, it just delegates to a method on the presentation model. So why not just put it there?</p>
<p>Many people refer to the Presentation Model pattern as ViewModel (or Model-View-ViewModel for the palindromically inclined). That's because the ViewModel is a model designed specifically for the view. It expresses view-ish concerns, without actually <em>being</em> the view.</p>
<p>One of those concerns is the list of commands that the view can invoke. The view can bind those commands to buttons, menu items, or any other visual element. That's how you move your code from the view to the presentation model.</p>
<p><strong>Create a command</strong><br />WPF gives us a technique known as command binding. A command is an implementation of the ICommand interface. When it is bound to a visual element's Command property, the command controls when the visual element is enabled, and what it does when clicked.</p>
<p>In the latest build of Update Controls (version 2.0.3.1), I added support for command binding. It takes the form of a static class called MakeCommand. Its job is to make commands. The syntax for creating a simple command looks like this:</p>
<pre><span style="color: blue">public</span> ICommand AddPerson
{
    get
    {
        <span style="color: blue">return</span> MakeCommand
            .Do(() =&gt;
            {
                Navigation.SelectedPerson = PersonList.NewPerson();
            });
    }
}
</pre><p>That funny arrow syntax is a lambda expression. This particular lambda expression takes no parameters, so there are empty parentheses on the left. This lambda executes a block of code, so there are curly braces on the right. This command will execute the code in those braces whenever the command is invoked, adding a person to the list and selecting them.</p>
<p>A slightly more complex command looks like this:</p>
<pre><span style="color: blue">public</span> ICommand DeletePerson
{
    get
    {
        <span style="color: blue">return</span> MakeCommand
            .When(() =&gt; Navigation.SelectedPerson != <span style="color: blue">null</span>)
            .Do(() =&gt;
            {
                PersonList.DeletePerson(Navigation.SelectedPerson);
            });
    }
}
</pre><p>Here we have two lambda expressions. The first tells us when the command can be executed, and the second tells us what it does. The When lambda returns a boolean. It says that this command is enabled only when the selected person is not null. The Do clause -- the one with the curly braces -- says that the selected person is deleted from the list when the command is invoked.</p>
<p>The advantage of using Update Controls for command binding is that it automatically keeps the view up-to-date as the When clause changes. Since the When clause above references the SelectedPerson property, it is reevaluated every time the selected person changes. There is no need to manually fire the CanExecuteChanged event that ICommand exposes.</p>
<p><strong>Bind to the command</strong><br />Now that the command is exposed as a property of the navigation model, it can be bound to elements in the view. Since the navigation model is already the DataContext of the view, it's just a matter of binding the Command property. For example:</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">Button</span> <span style="color: red">Content</span>="<span style="color: blue">Add</span>" <span style="color: red">Command</span>="<span style="color: blue">{u:Update AddPerson}</span>"/<span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span><span style="color: maroon">Button</span> <span style="color: red">Content</span>="<span style="color: blue">Delete</span>" <span style="color: red">Command</span>="<span style="color: blue">{u:Update DeletePerson}</span>"/<span style="color: blue">&gt;</span>
</pre><p>This binds the Add and Delete buttons to the AddPerson and DeletePerson commands. The When clause of these commands controls whether the buttons are enabled, and the Do clause is executed when the button is clicked.</p>
<p><strong>When not to move the code</strong><br />There is a button on this view that opens a new window. I have not moved this code into the presentation model, because it is concerned specifically with view logic. It creates a new view, something that the presentation model is incapable of doing. The presentation model does not have any dependency upon the view; the dependency goes the other way.</p>
<p>For now, I've chosen to leave that code in the view. In the future, there may be a component concerned with the flow of user interaction among different views. If that architectural concern is added, then opening a new window would become a feature of that class. Until then, the feature is more appropriate on the view than on the presentation model.</p>
<p>Moving the code out of the view and into the presentation model keeps it closer to the objects it needs. WPF command binding gives us a way to do that. The Update Controls MakeCommand class easily creates commands that can be bound to. These commands automatically keep the view up to date when the visual elements should be enabled or disabled.</p>
  <div id="book-navigation-11" class="book-navigation">
    
        <div class="page-links clear-block">
              <a href="hierarchical_check_boxes.html" class="page-previous" title="Go to previous page">‹ Hierarchical check boxes</a>
                    <a href="../examples.html" class="page-up" title="Go to parent page">up</a>
                    <a href="linq.html" class="page-next" title="Go to next page">Linq ›</a>
          </div>
    
  </div>
  </div>

  <ul class="links inline"><li class="blog_usernames_blog first"><a href="../blog/1.html" title="Read MichaelLPerry&#039;s latest blog entries.">MichaelLPerry&#039;s blog</a></li>
<li class="comment_add last"><a href="../comment/reply/14.html#comment-form" title="Share your thoughts and opinions related to this posting.">Add new comment</a></li>
</ul>
</div></div> <!-- /node-inner, /node -->
  <div id="comments">
          <h2 id="comments-title">Comments</h2>
        <a id="comment-609"></a>
<div class="comment comment-published odd first comment-by-anon"><div class="comment-inner clear-block">

      <h3 class="title">
      <a href="icommand.html#comment-609" class="active">Race condition?</a>          </h3>
  
  
  
  <div class="submitted">
    Submitted by Anonymous on Wed, 05/11/2011 - 17:09.  </div>

  <div class="content">
    <p>Navigation.SelectedPerson in both the .When() and .Do() clauses allows the possibility that the value could be set to null on another thread in between the check and the call, resulting in a null reference exception.  Is there a way to guard against this?  I can call BeginInvoke when setting of the value in the other thread if necessary which should solve it in my case, but thought I'd ask if this is something you have encountered.</p>
      </div>

      <div class="links">
      <ul class="links"><li class="comment_reply first last"><a href="../comment/reply/14/609.html">reply</a></li>
</ul>    </div>
  
</div></div> <!-- /comment-inner, /comment -->
<div class="indented"><a id="comment-610"></a>
<div class="comment comment-published even comment-by-author"><div class="comment-inner clear-block">

      <h3 class="title">
      <a href="icommand.html#comment-610" class="active">Good point</a>          </h3>
  
  
  
  <div class="submitted">
    Submitted by MichaelLPerry on Thu, 05/12/2011 - 20:54.  </div>

  <div class="content">
    <p>You are correct. That could cause a race condition. Anytime a shared resource is accessed twice, it could have a different value. Unfortunately, the place to put the lock is in the shared resource, not the caller. So there is nothing that MakeCommand could do to prevent the race condition.</p>
<p>If you need to access a shared resource in MakeCommand, I recommend putting a redundant check in Do. Copy the value into a local variable first so that it won't change before you act upon it.</p>
      </div>

      <div class="links">
      <ul class="links"><li class="comment_reply first last"><a href="../comment/reply/14/610.html">reply</a></li>
</ul>    </div>
  
</div></div> <!-- /comment-inner, /comment -->
</div><a id="comment-606"></a>
<div class="comment comment-published odd comment-by-anon"><div class="comment-inner clear-block">

      <h3 class="title">
      <a href="icommand.html#comment-606" class="active">Commands with arguments</a>          </h3>
  
  
  
  <div class="submitted">
    Submitted by Anonymous on Mon, 05/09/2011 - 15:11.  </div>

  <div class="content">
    <p>Is it possible to MakeCommand actions that take an argument?  For example an EditPerson command that takes an existing Person (or name)?</p>
      </div>

      <div class="links">
      <ul class="links"><li class="comment_reply first last"><a href="../comment/reply/14/606.html">reply</a></li>
</ul>    </div>
  
</div></div> <!-- /comment-inner, /comment -->
<div class="indented"><a id="comment-607"></a>
<div class="comment comment-published even comment-by-author"><div class="comment-inner clear-block">

      <h3 class="title">
      <a href="icommand.html#comment-607" class="active">Parameters not supported</a>          </h3>
  
  
  
  <div class="submitted">
    Submitted by MichaelLPerry on Tue, 05/10/2011 - 09:18.  </div>

  <div class="content">
    <p>MakeCommand does not currently support parameters. I recommend instead that you use the <a href="../tips/selectionmodel.html">Selection Model</a> pattern. Data bind the selected person to a property, and reference that property within your command. This pattern has many benefits over command parameters, including the ability to modify the selection from code in your view model.</p>
      </div>

      <div class="links">
      <ul class="links"><li class="comment_reply first last"><a href="../comment/reply/14/607.html">reply</a></li>
</ul>    </div>
  
</div></div> <!-- /comment-inner, /comment -->
<div class="indented"><a id="comment-608"></a>
<div class="comment comment-published odd last comment-by-anon"><div class="comment-inner clear-block">

      <h3 class="title">
      <a href="icommand.html#comment-608" class="active">Thanks</a>          </h3>
  
  
  
  <div class="submitted">
    Submitted by Anonymous on Tue, 05/10/2011 - 10:06.  </div>

  <div class="content">
    <p>Ah I see, that makes perfect sense. Thank you.</p>
      </div>

      <div class="links">
      <ul class="links"><li class="comment_reply first last"><a href="../comment/reply/14/608.html">reply</a></li>
</ul>    </div>
  
</div></div> <!-- /comment-inner, /comment -->
</div></div>  </div>
        </div>

        
        
      </div></div> <!-- /#content-inner, /#content -->

              <div id="navbar"><div id="navbar-inner" class="clear-block region region-navbar">

          <a name="navigation" id="navigation"></a>

          
                      <div id="primary">
              <ul class="links"><li class="menu-146 first"><a href="../../cs/index-2.html" title="">WPF</a></li>
<li class="menu-147"><a href="../../cs/silverlight.html" title="">Silverlight</a></li>
<li class="menu-148"><a href="../../cs/winforms.html" title="">Winforms</a></li>
<li class="menu-149"><a href="../../cs/download.html" title="">Download</a></li>
<li class="menu-150"><a href="../index.html" title="">Documentation</a></li>
<li class="menu-151"><a href="../../cs/videos.html" title="">Videos</a></li>
<li class="menu-152 last"><a href="../../cs/contact.html" title="">Contact Us</a></li>
</ul>            </div> <!-- /#primary -->
          
          
          
        </div></div> <!-- /#navbar-inner, /#navbar -->
      
              <div id="sidebar-left"><div id="sidebar-left-inner" class="region region-left">
          <div id="block-book-0" class="block block-book region-odd odd region-count-1 count-1"><div class="block-inner">

      <h2 class="title">Sections</h2>
  
  <div class="content">
    <div id="book-block-menu-43" class="book-block-menu">
  <ul class="menu"><li class="collapsed first last"><a href="../basics.html">The Basics</a></li>
</ul></div>
<div id="book-block-menu-11" class="book-block-menu">
  <ul class="menu"><li class="expanded first last active-trail"><a href="../examples.html">Examples</a><ul class="menu"><li class="leaf first"><a href="menus.html">Menus</a></li>
<li class="collapsed"><a href="treeview/non_recursive.html">TreeView</a></li>
<li class="leaf active-trail"><a href="icommand.html" class="active">ICommand</a></li>
<li class="leaf"><a href="linq.html">Linq</a></li>
<li class="leaf"><a href="../mvvm-and-linq-to-sql.html">Linq to SQL</a></li>
<li class="leaf"><a href="multi-threading.html">Multi-threading</a></li>
<li class="leaf"><a href="twolists.html">Two lists</a></li>
<li class="leaf"><a href="vmworkshop/wpf.html">VM Workshop</a></li>
<li class="leaf"><a href="awesome.html">Awesome application</a></li>
<li class="leaf"><a href="wp7_odata.html">Windows Phone 7 and OData</a></li>
<li class="leaf last"><a href="mvc-without-eventing.html">MVC without eventing</a></li>
</ul></li>
</ul></div>
<div id="book-block-menu-12" class="book-block-menu">
  <ul class="menu"><li class="collapsed first last"><a href="../tips.html">Tips</a></li>
</ul></div>
<div id="book-block-menu-32" class="book-block-menu">
  <ul class="menu"><li class="collapsed first last"><a href="../advanced.html">Advanced Topics</a></li>
</ul></div>
<div id="book-block-menu-24" class="book-block-menu">
  <ul class="menu"><li class="collapsed first last"><a href="../node/24.html">Other Articles</a></li>
</ul></div>
  </div>

  
</div></div> <!-- /block-inner, /block -->
<div id="block-node-0" class="block block-node region-even even region-count-2 count-2"><div class="block-inner">

      <h2 class="title">Subscribe</h2>
  
  <div class="content">
    <a href="../rss.xml" class="feed-icon"><img src="../misc/feed.png" alt="Syndicate content" title="Syndicate" width="16" height="16" /></a>  </div>

  
</div></div> <!-- /block-inner, /block -->
<div id="block-comment-0" class="block block-comment region-odd odd region-count-3 count-3"><div class="block-inner">

      <h2 class="title">Recent comments</h2>
  
  <div class="content">
    <div class="item-list"><ul><li class="first"><a href="../mvvm-and-linq-to-sql.html#comment-687">No longer preferred</a><br />3 years 13 weeks ago</li>
<li><a href="../mvvm-and-linq-to-sql.html#comment-684">Is this still the preferred way?</a><br />3 years 19 weeks ago</li>
<li><a href="../tips/common_mistakes_observablecollection.html#comment-668" class="active">Wrong. When replacing the</a><br />3 years 44 weeks ago</li>
<li><a href="../node/39.html#comment-667">Very nice</a><br />3 years 46 weeks ago</li>
<li><a href="../node/39.html#comment-666">Example Application</a><br />3 years 47 weeks ago</li>
<li><a href="../basics/make-command.html#comment-665">Responsibilities</a><br />4 years 3 days ago</li>
<li><a href="../basics/make-command.html#comment-664">Menus</a><br />4 years 3 days ago</li>
<li><a href="../tips/common_mistakes_observablecollection.html#comment-659" class="active">The reason that this is a</a><br />4 years 17 weeks ago</li>
<li><a href="../tips/common_mistakes_observablecollection.html#comment-658" class="active">You need to explain why these</a><br />4 years 17 weeks ago</li>
<li class="last"><a href="../validation.html#comment-657">RE: I like your approach, but ...</a><br />4 years 21 weeks ago</li>
</ul></div>  </div>

  
</div></div> <!-- /block-inner, /block -->
<div id="block-user-0" class="block block-user region-even even region-count-4 count-4"><div class="block-inner">

      <h2 class="title">User login</h2>
  
  <div class="content">
    <form action="http://updatecontrols.net/doc/examples/icommand?destination=node%2F14"  accept-charset="UTF-8" method="post" id="user-login-form">
<div><div class="form-item" id="edit-name-wrapper">
 <label for="edit-name">Username: <span class="form-required" title="This field is required.">*</span></label>
 <input type="text" maxlength="60" name="name" id="edit-name" size="15" value="" class="form-text required" />
</div>
<div class="form-item" id="edit-pass-wrapper">
 <label for="edit-pass">Password: <span class="form-required" title="This field is required.">*</span></label>
 <input type="password" name="pass" id="edit-pass"  maxlength="60"  size="15"  class="form-text required" />
</div>
<input type="submit" name="op" id="edit-submit" value="Log in"  class="form-submit" />
<div class="item-list"><ul><li class="first last"><a href="../user/password.html" title="Request new password via e-mail.">Request new password</a></li>
</ul></div><input type="hidden" name="form_build_id" id="form-96e81a5b35394c897a488ea7c616a273" value="form-96e81a5b35394c897a488ea7c616a273"  />
<input type="hidden" name="form_id" id="edit-user-login-block" value="user_login_block"  />

</div></form>
  </div>

  
</div></div> <!-- /block-inner, /block -->
        </div></div> <!-- /#sidebar-left-inner, /#sidebar-left -->
      
      
    </div></div> <!-- /#main-inner, /#main -->

          <div id="footer"><div id="footer-inner" class="region region-footer">

        
        <div id="block-system-0" class="block block-system region-odd odd region-count-1 count-5"><div class="block-inner">

  
  <div class="content">
    <a href="http://drupal.org/"><img src="../misc/powered-blue-80x15.png" alt="Powered by Drupal, an open source content management system" title="Powered by Drupal, an open source content management system" width="80" height="15" /></a>  </div>

  
</div></div> <!-- /block-inner, /block -->

      </div></div> <!-- /#footer-inner, /#footer -->
    
  </div></div> <!-- /#page-inner, /#page -->

  
  <script type="text/javascript" src="../sites/all/modules/google_analytics/googleanalytics4b43.js?r"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
try{var pageTracker = _gat._getTracker("UA-389401-4");pageTracker._trackPageview();} catch(err) {}
//--><!]]>
</script>

</body>

<!-- Mirrored from updatecontrols.net/doc/examples/icommand by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:54:30 GMT -->
</html>
